{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"\u7b80\u4ecb","text":"<p><code>cdns</code> \u662f\u4e00\u4e2a\u4f7f\u7528 Golang \u7f16\u5199\u7684\uff0c\u9ad8\u5ea6\u81ea\u5b9a\u4e49\u7684 DNS \u670d\u52a1\u5668</p> <p>\u672c\u9879\u76ee\u4f7f\u7528 <code>GPLv3</code> \u534f\u8bae\u5f00\u6e90</p>"},{"location":"#_2","title":"\u611f\u8c22","text":"<ul> <li>miekg/dns</li> <li>IrineSistiana/mosdns</li> </ul>"},{"location":"example/","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>log:\n  level: info\n\napi:\n  listen: 127.0.0.1:9088\n  secret: admin\n\nupstreams:\n  - tag: AliDNS\n    type: tls\n    address: 223.5.5.5\n\n  - tag: OpenDNS\n    type: tls\n    address: 208.67.222.222\n\n  - tag: GoogleDNS\n    type: tls\n    address: 8.8.8.8\n\n  - tag: WorldDNS # \u5e76\u53d1\u8bf7\u6c42\uff0c\u9632\u6b62\u5e94\u67d0\u4e9b\u539f\u56e0\u8bf7\u6c42\u5931\u8d25\n    type: parallel\n    upstreams:\n      - OpenDNS\n      - GoogleDNS\n\nplugin-matchers:\n  - tag: geosite\n    type: geosite\n    args:\n      type: sing\n      path: /etc/cdns/geosite.db # \u586b\u5199 geosite (sing-box) \u4f4d\u7f6e\n      code: gfw\n\nplugin-executors:\n  - tag: cache\n    type: memcache\n    args:\n      dump-file: /tmp/dns.cache\n      dump-interval: 10s\n\nworkflows:\n  - tag: main\n    rules:\n      - exec: # \u82e5\u547d\u4e2d\u7f13\u5b58\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\u7f13\u5b58\u7ed3\u679c\n          - plugin:\n              tag: cache\n              args:\n                mode: restore\n                return: true\n\n      - match-or: # \u5c4f\u853d AAAA \u548c HTTPS \u8bf7\u6c42\n          - qtype:\n              - 28 # AAAA\n              - HTTPS\n        exec:\n          - return: success # \u751f\u6210\u7a7a\u8bf7\u6c42\n\n      - match-or: # GFW \u5217\u8868\u91c7\u7528 WorldDNS \u67e5\u8be2\uff0c\u5426\u5219\u91c7\u7528 AliDNS \u67e5\u8be2\n          - plugin:\n              tag: geosite\n              args: gfw\n        exec:\n          - upstream: WorldDNS\n        else-exec:\n          - upstream: AliDNS\n\n      - exec:\n          - plugin: # \u7f13\u5b58\u7ed3\u679c\n              tag: cache\n              args:\n                mode: store\n\n\nlisteners:\n  - tag: listener-tcp\n    type: tcp\n    listen: :53\n    workflow: main\n\n  - tag: listener-udp\n    type: udp\n    listen: :53\n    workflow: main\n</code></pre>"},{"location":"global/","title":"\u914d\u7f6e\u7ed3\u6784","text":"<pre><code>log:\n\napi:\n\nupstreams:\n\nplugin-matchers:\n\nplugin-executors:\n\nworkflows:\n\nlisteners:\n</code></pre>"},{"location":"global/#log","title":"<code>log</code>","text":"<p>\u65e5\u5fd7\u914d\u7f6e</p>"},{"location":"global/#api","title":"<code>api</code>","text":"<p><code>HTTP API</code> \u914d\u7f6e</p>"},{"location":"global/#upstreams","title":"<code>upstreams</code>","text":"<p>\u4e0a\u6e38 <code>DNS</code> \u670d\u52a1\u5668\u914d\u7f6e</p>"},{"location":"global/#plugin-matchers","title":"<code>plugin-matchers</code>","text":"<p>\u5339\u914d\u5668\u63d2\u4ef6</p>"},{"location":"global/#plugin-executors","title":"<code>plugin-executors</code>","text":"<p>\u6267\u884c\u5668\u63d2\u4ef6</p>"},{"location":"global/#workflows","title":"<code>workflows</code>","text":"<p>\u5904\u7406\u6d41\u7a0b</p>"},{"location":"global/#listeners","title":"<code>listeners</code>","text":"<p>\u76d1\u542c\u5668</p>"},{"location":"api/api/","title":"API \u670d\u52a1\u5668","text":"<p><code>API</code> \u670d\u52a1\u5668\u652f\u6301\u66b4\u9732 HTTP \u63a5\u53e3\uff0c\u63d0\u4f9b\u66f4\u591a\u529f\u80fd</p> <pre><code>api:\n    listen: 127.0.0.1:8099 # HTTP \u76d1\u542c\u5730\u5740\n    secret: admin # \u9274\u6743\u5bc6\u7801\uff0c\u9700\u8bbe\u7f6e Header: Authorization Bearer ${secret}\n    debug: false # \u5f00\u542f pprof\n</code></pre> <p>\u8def\u5f84\uff1a</p> <ul> <li><code>/debug</code> ==&gt; pprof \u8def\u5f84\uff0c\u53ea\u6709\u5728 debug: true \u76d1\u542c</li> <li><code>/upstream</code> ==&gt; \u83b7\u53d6\u6240\u6709 Upstream API</li> <li><code>/upstream/${upstream-tag}</code> ==&gt; \u83b7\u53d6 Upstream API \u4fe1\u606f</li> <li><code>/plugin/matcher</code> ==&gt; \u83b7\u53d6\u6240\u6709 Plugin Matcher API</li> <li><code>/plugin/matcher/${plugin-matcher-tag}</code> ==&gt; \u83b7\u53d6 Plugin Matcher API \u4fe1\u606f</li> <li><code>/plugin/matcher/${plugin-matcher-tag}/help</code> ==&gt; \u83b7\u53d6 Plugin Matcher API \u6240\u6709\u63a5\u53e3\u4fe1\u606f</li> <li><code>/plugin/executor</code> ==&gt; \u83b7\u53d6\u6240\u6709 Plugin Executor API</li> <li><code>/plugin/executor/${plugin-executor-tag}</code> ==&gt; \u83b7\u53d6 Plugin Executor API \u4fe1\u606f</li> <li><code>/plugin/executor/${plugin-executor-tag}/help</code> ==&gt; \u83b7\u53d6 Plugin Executor API \u6240\u6709\u63a5\u53e3\u4fe1\u606f</li> </ul>"},{"location":"api/api/#upstream-api","title":"Upstream API","text":"<p>GET /upstream</p> <p>\u8fd4\u56de\u503c\uff1a <pre><code>{\n    \"data\": {\n        \"${upstream-tag}\": {\n            \"tag\": \"${upstream-tag}\",\n            \"type\": \"${upstream-type}\",\n            \"data\": {\n                \"total\": 0, # \u603b\u8bf7\u6c42\u6570\n                \"success\": 0 # \u6210\u529f\u8bf7\u6c42\u6570\n            }\n        }\n    }\n}\n</code></pre></p> <p>GET /upstream/${upstream-tag}</p> <p>\u8fd4\u56de\u503c\uff1a <pre><code>{\n    \"tag\": \"${upstream-tag}\",\n    \"type\": \"${upstream-type}\",\n    \"data\": {\n        \"total\": 0, # \u603b\u8bf7\u6c42\u6570\n        \"success\": 0 # \u6210\u529f\u8bf7\u6c42\u6570\n    }\n}\n</code></pre></p>"},{"location":"api/api/#plugin-matcher-api","title":"Plugin Matcher API","text":"<p>GET /plugin/matcher</p> <p>\u8fd4\u56de\u503c\uff1a <pre><code>{\n    \"data\": {\n        \"${plugin-matcher-tag}\": {\n            \"tag\": \"${plugin-matcher-tag}\",\n            \"type\": \"${plugin-matcher-type}\"\n        }\n    }\n}\n</code></pre></p> <p>GET /plugin/matcher/${plugin-matcher-tag}</p> <p>\u8fd4\u56de\u503c\uff1a <pre><code>{\n    \"tag\": \"${plugin-matcher-tag}\",\n    \"type\": \"${plugin-matcher-type}\"\n}\n</code></pre></p> <p>GET /plugin/matcher/${plugin-matcher-tag}/help</p> <p>\u8fd4\u56de\u503c\uff1a <pre><code>{\n    \"/${path}\": {\n        \"methods\": [...], // GET POST ...\n        \"description\": ... // API \u4ecb\u7ecd\n    }\n}\n</code></pre></p>"},{"location":"api/api/#plugin-executor-api","title":"Plugin Executor API","text":"<p>GET /plugin/executor</p> <p>\u8fd4\u56de\u503c\uff1a <pre><code>{\n    \"data\": {\n        \"${plugin-executor-tag}\": {\n            \"tag\": \"${plugin-executor-tag}\",\n            \"type\": \"${plugin-executor-type}\"\n        }\n    }\n}\n</code></pre></p> <p>GET /plugin/executor/${plugin-executor-tag}</p> <p>\u8fd4\u56de\u503c\uff1a <pre><code>{\n    \"tag\": \"${plugin-executor-tag}\",\n    \"type\": \"${plugin-executor-type}\"\n}\n</code></pre></p> <p>GET /plugin/executor/${plugin-executor-tag}/help</p> <p>\u8fd4\u56de\u503c\uff1a <pre><code>{\n    \"/${path}\": {\n        \"methods\": [...], // GET POST ...\n        \"description\": ... // API \u4ecb\u7ecd\n    }\n}\n</code></pre></p>"},{"location":"listener/","title":"Listener \u76d1\u542c\u5668","text":"<p>\u76d1\u542c\u5668\u4f1a\u521b\u5efa DNS \u670d\u52a1\u5668\u76d1\u542c\u8bf7\u6c42</p> <p>\u76ee\u524d\u652f\u6301\u4ee5\u4e0b\u76d1\u542c\u5668\uff1a</p> <ul> <li>UDP</li> <li>TCP</li> <li>TLS (DoT | DNS Over TLS)</li> <li>HTTP(S|3) (DoH | DoH3 | DNS Over HTTPS | DNS Over HTTP/3)</li> <li>QUIC (DoQ | DNS Over QUIC)</li> </ul>"},{"location":"listener/http/","title":"HTTP(S|3)","text":"<pre><code>listeners:\n    - tag: listener\n      type: http\n      deal-timeout: 20s # \u5904\u7406\u8d85\u65f6\u65f6\u95f4\n      listen: :443 # \u76d1\u542c\u5730\u5740\uff0c\u793a\u4f8b\uff1a127.0.0.1:53 [::1]:53 :53(\u76d1\u542c[::]:53)\n      # real-ip-header: X-Real-IP # \u4ece\u8bf7\u6c42\u5934\u83b7\u53d6\u771f\u5b9e IP \u7684\u5b57\u6bb5\uff0c\u53ef\u9009\uff0c\u9ed8\u8ba4\u4e3a\u7a7a\uff0ccdns \u4f1a\u81ea\u52a8\u4ece X-Real-IP X-Forwarded-For \u4e2d\u83b7\u53d6\u771f\u5b9e IP\n      # trust-ip: 127.0.0.1 # \u5b89\u5168\u9009\u9879\uff0c\u53ef\u9009\uff0c\u586b\u5199\u5219\u53ea\u5141\u8bb8\u4ece\u6307\u5b9a IP \u8bbf\u95ee\u8bfb\u53d6\u771f\u5b9e IP\n      # path: /dns-query # \u76d1\u542c\u8def\u5f84\uff0c\u53ef\u9009\uff0c\u9ed8\u8ba4\u4e3a /dns-query\n      # use-http3: false # \u662f\u5426\u542f\u7528 HTTP/3\uff0c\u53ef\u9009\uff0c\u9ed8\u8ba4\u4e3a false\uff0c\u586b\u5199 true \u5219\u5fc5\u586b TLS \u76f8\u5173\u914d\u7f6e\n      # enable-0rtt: false # \u662f\u5426\u542f\u7528 0-RTT (QUIC)\uff0c\u53ef\u9009\uff0c\u9ed8\u8ba4\u4e3a false\uff0c\u4ec5\u5728 use-http3: true \u6709\u6548\n      server-cert-file: /path/to/cert.pem # TLS \u8bc1\u4e66\u6587\u4ef6\uff0c\u53ef\u9009\uff0c\u586b\u5199\u5219\u4f7f\u7528 HTTPS\n      server-key-file: /path/to/key.pem # TLS \u79c1\u94a5\u6587\u4ef6\uff0c\u53ef\u9009\uff0c\u586b\u5199\u5219\u4f7f\u7528 HTTPS\n      # client-ca-file: /path/to/ca.pem # \u5ba2\u6237\u7aef CA \u8bc1\u4e66\u6587\u4ef6\uff0c\u7528\u4e8e mTLS\uff0c\u53ef\u9009\uff0c\u586b\u5199\u5219\u4f7f\u7528 HTTPS\n      # client-ca-file: # \u652f\u6301\u591a\u6587\u4ef6\n      #   - /path/to/ca1.pem\n      #   - /path/to/ca2.pem\n</code></pre>"},{"location":"listener/quic/","title":"QUIC","text":"<pre><code>listeners:\n    - tag: listener\n      type: quic\n      deal-timeout: 20s # \u5904\u7406\u8d85\u65f6\u65f6\u95f4\n      listen: :853 # \u76d1\u542c\u5730\u5740\uff0c\u793a\u4f8b\uff1a127.0.0.1:53 [::1]:53 :53(\u76d1\u542c[::]:53)\n      idle-timeout: 60s # \u8fde\u63a5\u7a7a\u95f2\u8d85\u65f6\u65f6\u95f4\n      enable-0rtt: false # \u662f\u5426\u542f\u7528 0-RTT (QUIC)\n      server-cert-file: /path/to/cert.pem # TLS \u8bc1\u4e66\u6587\u4ef6\n      server-key-file: /path/to/key.pem # TLS \u79c1\u94a5\u6587\u4ef6\n      # client-ca-file: /path/to/ca.pem # \u5ba2\u6237\u7aef CA \u8bc1\u4e66\u6587\u4ef6\uff0c\u7528\u4e8e mTLS\n      # client-ca-file: # \u652f\u6301\u591a\u6587\u4ef6\n      #   - /path/to/ca1.pem\n      #   - /path/to/ca2.pem\n</code></pre>"},{"location":"listener/tcp/","title":"TCP","text":"<pre><code>listeners:\n    - tag: listener\n      type: tcp\n      deal-timeout: 20s # \u5904\u7406\u8d85\u65f6\u65f6\u95f4\n      listen: :6053 # \u76d1\u542c\u5730\u5740\uff0c\u793a\u4f8b\uff1a127.0.0.1:53 [::1]:53 :53(\u76d1\u542c[::]:53)\n      idle-timeout: 60s # \u8fde\u63a5\u7a7a\u95f2\u8d85\u65f6\u65f6\u95f4\n</code></pre>"},{"location":"listener/tls/","title":"TLS","text":"<pre><code>listeners:\n    - tag: listener\n      type: tls\n      deal-timeout: 20s # \u5904\u7406\u8d85\u65f6\u65f6\u95f4\n      listen: :853 # \u76d1\u542c\u5730\u5740\uff0c\u793a\u4f8b\uff1a127.0.0.1:53 [::1]:53 :53(\u76d1\u542c[::]:53)\n      idle-timeout: 60s # \u8fde\u63a5\u7a7a\u95f2\u8d85\u65f6\u65f6\u95f4\n      server-cert-file: /path/to/cert.pem # TLS \u8bc1\u4e66\u6587\u4ef6\n      server-key-file: /path/to/key.pem # TLS \u79c1\u94a5\u6587\u4ef6\n      # client-ca-file: /path/to/ca.pem # \u5ba2\u6237\u7aef CA \u8bc1\u4e66\u6587\u4ef6\uff0c\u7528\u4e8e mTLS\n      # client-ca-file: # \u652f\u6301\u591a\u6587\u4ef6\n      #   - /path/to/ca1.pem\n      #   - /path/to/ca2.pem\n</code></pre>"},{"location":"listener/udp/","title":"UDP","text":"<pre><code>listeners:\n    - tag: listener\n      type: udp\n      deal-timeout: 20s # \u5904\u7406\u8d85\u65f6\u65f6\u95f4\n      listen: :6053 # \u76d1\u542c\u5730\u5740\uff0c\u793a\u4f8b\uff1a127.0.0.1:53 [::1]:53 :53(\u76d1\u542c[::]:53)\n</code></pre>"},{"location":"log/log/","title":"Log \u65e5\u5fd7","text":"<pre><code>log:\n    level: info # \u65e5\u5fd7\u7b49\u7ea7\uff0c\u53ef\u9009 debug | info | warn | error | fatal\n    output: /path/to/file.log # \u65e5\u5fd7\u6587\u4ef6\uff0c\u53ef\u9009 stdout\uff1a\u6807\u51c6\u8f93\u51fa \uff0cstderr\uff1a\u9519\u8bef\u8f93\u51fa\n    disable-timestamp: false # \u7981\u7528\u65f6\u95f4\u6233\u4fe1\u606f\n    disable-color: false # \u7981\u7528\u989c\u8272\u8f93\u51fa\uff0c\u5f53 output \u4e3a\u6587\u4ef6\u65f6\u9ed8\u8ba4\u7981\u7528\n</code></pre>"},{"location":"plugin/executor/","title":"Plugin Executor \u6267\u884c\u5668\u63d2\u4ef6","text":"<pre><code>plugin-executors:\n    - tag: plugin # \u63d2\u4ef6\u6807\u7b7e\n      type: ${type} # \u63d2\u4ef6\u7c7b\u578b\n      args: ... # \u63d2\u4ef6\u53c2\u6570\n\nworkflows:\n    - tag: default\n      rules:\n        - match-and:\n            - plugin:\n                tag: plugin # \u6267\u884c\u5668\u63d2\u4ef6\u6807\u7b7e\n                args: ... # \u8fd0\u884c\u65f6\u63d2\u4ef6\u53c2\u6570\n</code></pre> <p>\u76ee\u524d\u652f\u6301\u7684\u5339\u914d\u5668\u63d2\u4ef6\u5217\u8868\uff1a</p> <ul> <li>memcache</li> <li>rediscache</li> <li>script</li> <li>ecs</li> <li>ipset</li> </ul>"},{"location":"plugin/executor/ecs/","title":"ECS","text":"<p>ECS \u53ef\u4ee5\u9644\u52a0 <code>edns client subnet</code> \u8bb0\u5f55</p> <pre><code>plugin-executors:\n    - tag: plugin\n      type: ecs\n      args:\n        ipv4: 192.168.1.1\n        ipv6: 2001:db8::1\n        mask4: 24\n        mask6: 60\n\nworkflows:\n    - tag: default\n      rules:\n        - exec:\n            - plugin:\n                tag: plugin\n</code></pre>"},{"location":"plugin/executor/ipset/","title":"IPSet","text":"<p>IPSet \u53ef\u4ee5\u5c06 <code>IP</code> \u6dfb\u52a0\u5230 IPSet\uff0c\u4ec5\u652f\u6301 Linux</p> <pre><code>plugin-executors:\n    - tag: plugin\n      type: ipset\n      args:\n        name4: set4 # IPv4 IPSet \u540d\u79f0\n        name6: set6 # IPv6 IPSet \u540d\u79f0\n        mask4: 32 # IPv4 IPSet \u63a9\u7801\n        mask6: 128 # IPv6 IPSet \u63a9\u7801\n        ttl4: 600s # IPv4 IPSet TTL\n        ttl6: 600s # IPv6 IPSet TTL\n        create4: false # \u662f\u5426\u5728\u542f\u52a8\u65f6\u521b\u5efa\n        create6: false # \u662f\u5426\u5728\u542f\u52a8\u65f6\u521b\u5efa\n        destroy4: false # \u662f\u5426\u5728\u505c\u6b62\u65f6\u9500\u6bc1\n        destroy6: false # \u662f\u5426\u5728\u505c\u6b62\u65f6\u9500\u6bc1\n\nworkflows:\n    - tag: default\n      rules:\n        - exec:\n            - plugin:\n                tag: plugin\n                # args:\n                #   use-client-ip: false # \u4f7f\u7528\u5ba2\u6237\u7aef IP\uff0c\u800c\u975e DNS \u8fd4\u56de\u7684 IP\n</code></pre>"},{"location":"plugin/executor/ipset/#api","title":"API","text":"<p>GET /flush</p> <p>\u6e05\u7a7a IPSet</p> <p>\u8fd4\u56de\u72b6\u6001\uff1a204</p>"},{"location":"plugin/executor/memcache/","title":"MemCache \u7f13\u5b58","text":"<p>MemCache \u7f13\u5b58\u53ef\u4ee5\u7f13\u5b58\u8fd4\u56de\u7684\u7ed3\u679c\uff0c\u63d0\u9ad8\u6027\u80fd</p> <pre><code>plugin-executors:\n    - tag: plugin\n      type: memcache\n      args:\n        dump-path: /path/to/rule # \u7f13\u5b58\u6587\u4ef6\uff0c\u53ef\u9009\n        dump-interval: 0 # \u81ea\u52a8\u7f13\u5b58\u65f6\u95f4\u95f4\u9694\n\nworkflows:\n    - tag: default\n      rules:\n        - exec:\n            - plugin:\n                tag: plugin\n                args:\n                  mode: store # \u7f13\u5b58\u7ed3\u679c\n                  return: true # \u7f13\u5b58\u6210\u529f\u540e\uff0c\u7ec8\u6b62\u6240\u6709\u5904\u7406\u6d41\u7a0b\uff0c\u5e76\u8fd4\u56de\n\n        - exec:\n            - plugin:\n                tag: plugin\n                args:\n                  mode: restore # \u4ece\u7f13\u5b58\u83b7\u53d6\u7ed3\u679c\n                  return: true # \u83b7\u53d6\u7f13\u5b58\u6210\u529f\u540e\uff0c\u7ec8\u6b62\u6240\u6709\u5904\u7406\u6d41\u7a0b\uff0c\u5e76\u8fd4\u56de\n</code></pre>"},{"location":"plugin/executor/memcache/#api","title":"API","text":"<p>GET /dump</p> <p>\u5c06\u7f13\u5b58\u4fdd\u6301\u5230\u672c\u5730\u6587\u4ef6</p> <p>\u8fd4\u56de\u72b6\u6001\uff1a204</p> <p>GET | DELETE /flush</p> <p>\u5220\u9664\u6240\u6709\u5185\u5b58\u4e2d\u7684\u7f13\u5b58</p> <p>\u8fd4\u56de\u72b6\u6001\uff1a204</p>"},{"location":"plugin/executor/rediscache/","title":"RedisCache \u7f13\u5b58","text":"<p>RedisCache \u7f13\u5b58\u53ef\u4ee5\u7f13\u5b58\u8fd4\u56de\u7684\u7ed3\u679c\uff0c\u63d0\u9ad8\u6027\u80fd\uff0c\u4f7f\u7528 Redis \u4f5c\u4e3a\u5b58\u50a8\u673a\u5236</p> <pre><code>plugin-executors:\n    - tag: plugin\n      type: rediscache\n      args:\n        address: 127.0.0.1:6379 # Redis \u5730\u5740\uff0c\u652f\u6301 Unix Socket\n        password: '' # Redis \u5bc6\u7801\n        db: 0 # Redis DB\n\nworkflows:\n    - tag: default\n      rules:\n        - exec:\n            - plugin:\n                tag: plugin\n                args:\n                  mode: store # \u7f13\u5b58\u7ed3\u679c\n                  return: true # \u7f13\u5b58\u6210\u529f\u540e\uff0c\u7ec8\u6b62\u6240\u6709\u5904\u7406\u6d41\u7a0b\uff0c\u5e76\u8fd4\u56de\n\n        - exec:\n            - plugin:\n                tag: plugin\n                args:\n                  mode: restore # \u4ece\u7f13\u5b58\u83b7\u53d6\u7ed3\u679c\n                  return: true # \u83b7\u53d6\u7f13\u5b58\u6210\u529f\u540e\uff0c\u7ec8\u6b62\u6240\u6709\u5904\u7406\u6d41\u7a0b\uff0c\u5e76\u8fd4\u56de\n</code></pre>"},{"location":"plugin/executor/rediscache/#api","title":"API","text":"<p>GET | DELETE /flush</p> <p>\u5220\u9664\u6240\u6709 Redis \u4e2d\u7684\u7f13\u5b58</p> <p>\u8fd4\u56de\u72b6\u6001\uff1a204</p>"},{"location":"plugin/executor/script/","title":"Script \u811a\u672c","text":"<p>Script \u811a\u672c\u53ef\u4ee5\u89e6\u53d1\u811a\u672c\u8fd0\u884c</p> <p>Script \u4f1a\u5c06\u5f53\u524d\u8bf7\u6c42\u5404\u79cd\u4fe1\u606f\u5b58\u50a8\u73af\u5883\u53d8\u91cf\u4e2d</p> <p>\u652f\u6301\u7684\u4fe1\u606f\uff1a</p> <ul> <li><code>CDNS_ID</code> ==&gt; \u8bf7\u6c42\u7684 ID</li> <li><code>CDNS_INIT_TIME</code> ==&gt; \u8bf7\u6c42\u521d\u59cb\u5316\u7684\u65f6\u95f4</li> <li><code>CDNS_LISTENER</code> ==&gt; \u8bf7\u6c42\u6765\u6e90\u7684\u76d1\u542c\u5668\u6807\u7b7e</li> <li><code>CDNS_CLIENT_IP</code> ==&gt; \u8bf7\u6c42\u6765\u6e90\u7684 <code>IP</code></li> <li><code>CDNS_REQ_QNAME</code> ==&gt; \u8bf7\u6c42\u7684 <code>QName</code></li> <li><code>CDNS_REQ_QTYPE</code> ==&gt; \u8bf7\u6c42\u7684 <code>QType</code>\uff0c\u4f8b\u5982\uff1aAAAA</li> <li><code>CDNS_REQ_QCLASS</code> ==&gt; \u8bf7\u6c42\u7684 <code>QClass</code>\uff0c\u4f8b\u5982\uff1aIN</li> <li><code>CDNS_RESP_IP_LEN</code> ==&gt; \u8fd4\u56de\u7684 <code>IP</code> \u4e2a\u6570\uff0c\u4ec5\u5f53\u8bf7\u6c42\u7c7b\u578b\u4e3a A | AAAA \u65f6\u6709\u6548</li> <li><code>CDNS_RESP_IP_${i}</code> ==&gt; \u8fd4\u56de\u7684 <code>IP</code>\uff0c\u4ece 1 \u5f00\u59cb</li> <li><code>CDNS_RESP_UPSTREAM_TAG</code> ==&gt; \u8bf7\u6c42\u7684\u4e0a\u6e38\u670d\u52a1\u5668\u6807\u7b7e</li> <li><code>CDNS_MARK</code> ==&gt; \u8bf7\u6c42\u4e0a\u4e0b\u6587\u7684 <code>Mark</code></li> <li><code>CDNS_METADATA_${KEY}</code> ==&gt; \u8bf7\u6c42\u4e0a\u4e0b\u6587\u7684 <code>Metadata</code>\uff0c\u5b57\u7b26\u4e32\u5168\u90e8\u5927\u5199</li> </ul> <ul> <li>Script \u8fd8\u652f\u6301\u66ff\u6362 <code>args</code> \u4e2d\u7684\u5b57\u7b26\u4e32\uff0c\u53ea\u9700\u8981\u5728 <code>args</code> \u8bbe\u7f6e {KEY} \u5373\u53ef</li> </ul> <pre><code>plugin-executors:\n    - tag: plugin\n      type: script\n      args:\n        command: bash\n        # args: '-c'\n        # args:\n        #   - '-c'\n        #   - '-b'\n\nworkflows:\n    - tag: default\n      rules:\n        - exec:\n            - plugin:\n                tag: plugin\n</code></pre>"},{"location":"plugin/matcher/","title":"Plugin Matcher \u5339\u914d\u5668\u63d2\u4ef6","text":"<pre><code>plugin-matchers:\n    - tag: plugin # \u63d2\u4ef6\u6807\u7b7e\n      type: ${type} # \u63d2\u4ef6\u7c7b\u578b\n      args: ... # \u63d2\u4ef6\u53c2\u6570\n\nworkflows:\n    - tag: default\n      rules:\n        - match-and:\n            - plugin:\n                tag: plugin # \u5339\u914d\u5668\u63d2\u4ef6\u6807\u7b7e\n                args: ... # \u8fd0\u884c\u65f6\u63d2\u4ef6\u53c2\u6570\n</code></pre> <p>\u76ee\u524d\u652f\u6301\u7684\u5339\u914d\u5668\u63d2\u4ef6\u5217\u8868\uff1a</p> <ul> <li>domain</li> <li>ip</li> <li>geosite</li> <li>maxminddb</li> <li>script</li> </ul>"},{"location":"plugin/matcher/domain/","title":"Domain \u57df\u540d\u5339\u914d","text":"<p>\u57df\u540d\u5339\u914d\u5668\u53ef\u4ee5\u7075\u6d3b\u5339\u914d\u57df\u540d\uff0c\u63d0\u4f9b\u6bd4 <code>qname</code> \u66f4\u7075\u6d3b\u7684\u89c4\u5219\u673a\u5236</p> <pre><code>plugin-matchers:\n    - tag: plugin\n      type: domain\n      args:\n        rule: 'full:google.com' # \u5339\u914d\u89c4\u5219\n        # rule:\n        #   - 'github.com' # \u7b49\u6548\u4e8e suffix:github.com\n        #   - 'full:google.com'\n        #   - 'suffix:google.com'\n        #   - 'keyword:google'\n        #   - 'regex:google'\n        file: /path/to/rule # \u89c4\u5219\u6587\u4ef6\n        # file:\n        #   - /path/to/file1\n        #   - /path/to/file2\n\nworkflows:\n    - tag: default\n      rules:\n        - match-and:\n            - plugin:\n                tag: plugin\n          exec:\n            ...\n</code></pre>"},{"location":"plugin/matcher/domain/#api","title":"API","text":"<p>GET /reload</p> <p>\u91cd\u65b0\u52a0\u8f7d\u89c4\u5219\u6587\u4ef6</p> <p>\u8fd4\u56de\u72b6\u6001\uff1a204</p>"},{"location":"plugin/matcher/geosite/","title":"GeoSite \u57df\u540d\u5339\u914d","text":"<p>GeoSite \u5339\u914d\u5668\u53ef\u4ee5\u7075\u6d3b\u5339\u914d\u57df\u540d\uff0c\u63d0\u4f9b\u6bd4 <code>qname</code> \u66f4\u7075\u6d3b\u7684\u89c4\u5219\u673a\u5236</p> <pre><code>plugin-matchers:\n    - tag: plugin\n      type: geosite\n      args:\n        path: /path/to/file # \u89c4\u5219\u6587\u4ef6\n        type: sing # geosite \u6587\u4ef6\u7c7b\u578b\uff0c\u5fc5\u586b\uff0c\u53ef\u9009 sing | meta | v2ray\n        code: cn # \u8f7d\u5165\u7684\u6807\u7b7e\uff0c\u4e3a\u7a7a\u8f7d\u5165\u6240\u6709\u6807\u7b7e\uff0c\u8fd9\u4f1a\u589e\u52a0\u5185\u5b58\u5360\u7528\uff0c\u53ea\u5f53 type: sing | v2ray \u751f\u6548\n        # code: # \u8f7d\u5165\u591a\u4e2a\u6807\u7b7e\n        #   - cn\n        #   - google\n\nworkflows:\n    - tag: default\n      rules:\n        - match-and:\n            - plugin:\n                tag: plugin\n                args: cn # \u5339\u914d\u7684\u6807\u7b7e\uff0c\u53ea\u5f53 type: sing | v2ray \u751f\u6548\n                # args: cn,google # \u591a\u4e2a\u5339\u914d\u7684\u6807\u7b7e\n                # args: # \u591a\u4e2a\u5339\u914d\u7684\u6807\u7b7e\n                #   - cn\n                #   - google,netflix\n                # args: # \u8fd9\u6837\u4e5f\u53ef\u4ee5\n                #   code: cn\n                # args: # \u8fd9\u6837\u4e5f\u53ef\u4ee5\n                #   code:\n                #     - cn\n                #     - google\n          exec:\n            ...\n</code></pre>"},{"location":"plugin/matcher/geosite/#api","title":"API","text":"<p>GET /reload</p> <p>\u91cd\u65b0\u52a0\u8f7d\u89c4\u5219\u6587\u4ef6</p> <p>\u8fd4\u56de\u72b6\u6001\uff1a204</p>"},{"location":"plugin/matcher/geosite/#_1","title":"\u6ce8\u610f","text":"<p>Release \u6784\u5efa\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u9ed8\u8ba4\u5305\u542b\u4e09\u79cd\u4e0d\u540c\u7c7b\u578b\u7684 <code>geosite</code>\uff0c\u6587\u4ef6\u4f53\u79ef\u53ef\u80fd\u5f88\u5927\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>UPX</code> \u5de5\u5177\u538b\u7f29\u3002\u5982\u679c\u6587\u4ef6\u5927\u5c0f\u4f9d\u7136\u65e0\u6cd5\u63a5\u53d7\uff0c\u53ef\u4ee5\u81ea\u884c\u7f16\u8bd1\u53bb\u9664\u4e0d\u9700\u8981\u7684 <code>geosite</code> \u7c7b\u578b\u3002</p> <p>\u65b9\u6cd5\uff1a\u5728 <code>plugin/matcher/geosite/geosite.go</code> \u4e2d\u4fee\u6539 <code>import</code> \u5373\u53ef</p> <pre><code>// \u53d6\u6d88\u524d\u9762\u7684\u6ce8\u91ca\u5373\u53ef\nimport (\n    \"github.com/rnetx/cdns/plugin/matcher/geosite/meta\" // \u6dfb\u52a0 meta \u683c\u5f0f\u652f\u6301\n    // meta \"github.com/rnetx/cdns/plugin/matcher/geosite/meta_stub\" // \u4e0d\u6dfb\u52a0 meta \u683c\u5f0f\u652f\u6301\n\n    \"github.com/rnetx/cdns/plugin/matcher/geosite/sing\" // \u6dfb\u52a0 sing \u683c\u5f0f\u652f\u6301\n    // sing \"github.com/rnetx/cdns/plugin/matcher/geosite/sing_stub\" // \u4e0d\u6dfb\u52a0 sing \u683c\u5f0f\u652f\u6301\n\n    \"github.com/rnetx/cdns/plugin/matcher/geosite/v2xray\" // \u6dfb\u52a0 v2ray \u683c\u5f0f\u652f\u6301\n    // v2xray \"github.com/rnetx/cdns/plugin/matcher/geosite/v2xray_stub\" // \u4e0d\u6dfb\u52a0 v2ray \u683c\u5f0f\u652f\u6301\n)\n</code></pre>"},{"location":"plugin/matcher/ip/","title":"IP \u5339\u914d","text":"<p><code>IP</code> \u5339\u914d\u5668\u53ef\u4ee5\u7075\u6d3b\u5339\u914d\u8fd4\u56de\u7684 <code>IP</code>\uff0c\u63d0\u4f9b\u6bd4 <code>resp-ip</code> \u66f4\u7075\u6d3b\u7684\u89c4\u5219\u673a\u5236</p> <pre><code>plugin-matchers:\n    - tag: plugin\n      type: ip\n      args:\n        rule: '192.168.1.1' # \u5339\u914d\u89c4\u5219\n        # rule:\n        #   - '192.168.1.1'\n        #   - '192.168.1.0/24'\n        file: /path/to/rule # \u89c4\u5219\u6587\u4ef6\n        # file:\n        #   - /path/to/file1\n        #   - /path/to/file2\n\nworkflows:\n    - tag: default\n      rules:\n        - match-and:\n            - plugin:\n                tag: plugin\n          exec:\n            ...\n</code></pre>"},{"location":"plugin/matcher/ip/#api","title":"API","text":"<p>GET /reload</p> <p>\u91cd\u65b0\u52a0\u8f7d\u89c4\u5219\u6587\u4ef6</p> <p>\u8fd4\u56de\u72b6\u6001\uff1a204</p>"},{"location":"plugin/matcher/maxminddb/","title":"MaxmindDB IP \u5339\u914d","text":"<p>MaxmindDB \u5339\u914d\u5668\u53ef\u4ee5\u7075\u6d3b\u5339\u914d\u8fd4\u56de\u7684 <code>IP</code>\uff0c\u63d0\u4f9b\u6bd4 <code>resp-ip</code> \u66f4\u7075\u6d3b\u7684\u89c4\u5219\u673a\u5236</p> <pre><code>plugin-matchers:\n    - tag: plugin\n      type: maxminddb\n      args:\n        path: /path/to/file # maxminddb \u6587\u4ef6\n        type: sing # MaxmindDB \u6587\u4ef6\u7c7b\u578b\uff0c\u53ef\u9009 sing | meta | geolite2-country\n\nworkflows:\n    - tag: default\n      rules:\n        - match-and:\n            - plugin:\n                tag: plugin\n                args: cn # \u5339\u914d\u7684\u6807\u7b7e\n                # args: cn,google # \u591a\u4e2a\u5339\u914d\u7684\u6807\u7b7e\n                # args: # \u591a\u4e2a\u5339\u914d\u7684\u6807\u7b7e\n                #   - cn\n                #   - google,netflix\n                # args: # \u8fd9\u6837\u4e5f\u53ef\u4ee5\n                #   code: cn\n                # args: # \u8fd9\u6837\u4e5f\u53ef\u4ee5\n                #   code:\n                #     - cn\n                #     - google\n          exec:\n            ...\n</code></pre>"},{"location":"plugin/matcher/maxminddb/#api","title":"API","text":"<p>GET /reload</p> <p>\u91cd\u65b0\u52a0\u8f7d\u89c4\u5219\u6587\u4ef6</p> <p>\u8fd4\u56de\u72b6\u6001\uff1a204</p>"},{"location":"plugin/matcher/script/","title":"Script \u811a\u672c\u5339\u914d","text":"<p>\u811a\u672c\u5339\u914d\u5668\u53ef\u4ee5\u6839\u636e\u811a\u672c\u8fd0\u884c\u7ed3\u679c\u8fdb\u884c\u5339\u914d</p> <p>\u811a\u672c\u9700\u8981\u5728\u6807\u51c6\u8f93\u51fa\u8fd4\u56de\u5e76\u4e14\u53ea\u80fd\u8fd4\u56de\u4ee5\u4e0b\u5185\u5bb9\uff1a <pre><code>1, t, T, TRUE, true, True, 0, f, F, FALSE, false, False\n</code></pre></p> <pre><code>plugin-matchers:\n    - tag: plugin\n      type: script\n      args:\n        command: bash\n        # args: '-c'\n        # args:\n        #   - '-b'\n        #   - '-b'\n        interval: 300s # \u811a\u672c\u6267\u884c\u95f4\u9694\n\nworkflows:\n    - tag: default\n      rules:\n        - match-and:\n            - plugin:\n                tag: plugin\n          exec:\n            ...\n</code></pre>"},{"location":"plugin/matcher/script/#api","title":"API","text":"<p>GET /run</p> <p>\u624b\u52a8\u6267\u884c\u4e00\u904d\u811a\u672c</p> <p>\u8fd4\u56de\u72b6\u6001\uff1a204</p> <p>GET /result</p> <p>\u83b7\u53d6\u5f53\u524d\u72b6\u6001</p> <p>\u8fd4\u56de\u503c\uff1a <pre><code>{\n    \"result\": true\n}\n</code></pre></p>"},{"location":"upstream/","title":"Upstream \u4e0a\u6e38\u670d\u52a1\u5668","text":"<p>\u4e0a\u6e38\u670d\u52a1\u5668\u8d1f\u8d23\u5411\u4e0a\u6e38\u670d\u52a1\u5668\u8f6c\u53d1\u8bf7\u6c42\uff0c\u5c06\u4e0a\u6e38\u670d\u52a1\u5668\u7684\u54cd\u5e94\u8fd4\u56de</p> <p>\u76ee\u524d\u652f\u6301\u4ee5\u4e0b\u4e0a\u6e38\u670d\u52a1\u5668\uff1a</p> <ul> <li>UDP</li> <li>TCP</li> <li>TLS (DoT | DNS Over TLS)</li> <li>HTTPS(3) (DoH | DoH3 | DNS Over HTTPS | DNS Over HTTP/3)</li> <li> <p>QUIC (DoQ | DNS Over QUIC)</p> </li> <li> <p>Parallel</p> </li> <li>Random</li> <li>QueryTest</li> <li>Hosts</li> <li>DHCP</li> </ul>"},{"location":"upstream/dhcp/","title":"DHCP","text":"<pre><code>upstreams:\n    - tag: upstream\n      type: dhcp\n      interface: eth0 # \u7ed1\u5b9a\u7684\u7f51\u5361\uff0c\u7559\u7a7a\u81ea\u52a8\u9009\u62e9\uff0c\u53ef\u80fd\u4f1a\u5931\u8d25\n      # flush-interval: 0s # \u81ea\u52a8\u66f4\u65b0\u65f6\u95f4\u95f4\u9694\n      #\n      # \u4ee5\u4e0b\u914d\u7f6e\u662f\u521b\u5efa UDP DNS \u670d\u52a1\u5668\u65f6\u4f7f\u7528\u914d\u7f6e\n      #\n      # connect-timeout: 30s # \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\n      # idle-timeout: 60s # \u8fde\u63a5\u7a7a\u95f2\u8d85\u65f6\u65f6\u95f4\n      # edns0: false # \u542f\u7528 EDNS0 \u652f\u6301\uff0c\u8be6\u60c5\u53c2\u8003 https://github.com/IrineSistiana/udpme\n      # enable-pipeline: false # \u662f\u5426\u542f\u7528 Pipeline (TCP)\n</code></pre>"},{"location":"upstream/hosts/","title":"Hosts","text":"<p>\u6839\u636e\u89c4\u5219\u8fd4\u56de\u6307\u5b9a IPv4 / IPv6 \u5730\u5740\uff0c\u4ec5\u652f\u6301 (A | AAAA) \u8bf7\u6c42\u3002\u6ca1\u6709\u89c4\u5219\u5339\u914d\u7684\u8bf7\u6c42\u6216\u8005\u975e (A | AAAA) \u8bf7\u6c42\u5c06\u53d1\u9001\u5230 fallback \u4e0a\u6e38\u670d\u52a1\u5668</p> <pre><code>upstreams:\n    - tag: upstream\n      type: hosts\n      fallback: upstream-fallback # \u6ca1\u6709\u89c4\u5219\u5339\u914d\u7684\u8bf7\u6c42\u6216\u8005\u975e (A | AAAA) \u8bf7\u6c42\u5c06\u53d1\u9001\u5230 fallback \u4e0a\u6e38\u670d\u52a1\u5668\n      rule: # \u89c4\u5219\uff0c\u952e\u503c\u5bf9(\u6b63\u5219\u8868\u8fbe\u5f0f\u5b57\u7b26\u4e32 =&gt; IP / CIDR)\n        '^example.*': 192.168.1.1\n        'cloudflare': # \u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\u5730\u5740\n          - 192.168.1.1\n          - 192.168.1.0/24 # \u652f\u6301 CIDR \uff0c\u4f1a\u968f\u673a\u4ece\u8fd9\u4e2a\u8303\u56f4\u4e2d\u9009\u62e9\u4e00\u4e2a\n</code></pre>"},{"location":"upstream/https/","title":"HTTPS(3)","text":"<pre><code>upstreams:\n    - tag: upstream\n      type: https\n      address: 223.5.5.5 # \u670d\u52a1\u5668\u5730\u5740\uff0c\u652f\u6301\u57df\u540d|\u57df\u540d:\u7aef\u53e3|IP|IP:\u7aef\u53e3\uff0c\u82e5\u670d\u52a1\u5668\u5730\u5740\u662f\u57df\u540d\uff0c\u5fc5\u987b\u8bbe\u7f6e bootstrap \u6216\uff08\u548c\uff09socks5\n      # connect-timeout: 30s # \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\n      # idle-timeout: 60s # \u8fde\u63a5\u7a7a\u95f2\u8d85\u65f6\u65f6\u95f4\n      # use-http3: false # \u662f\u5426\u4f7f\u7528 HTTP/3\n      # use-post: false # \u662f\u5426\u4f7f\u7528 POST \u65b9\u6cd5\u53d1\u9001\u8bf7\u6c42\n      # path: /dns-query # HTTP \u8def\u5f84\uff0c\u9ed8\u8ba4\u4e3a /dns-query\n      # headers: # HTTP Header\n      #   User-Agent: cdns\n      # servername: '' # TLS SNI\uff0c\u82e5\u4e3a\u7a7a\uff0c\u5219\u8bbe\u7f6e\u4e3a address\n      # insecure: false # \u4e0d\u9a8c\u8bc1\u670d\u52a1\u5668\u8bc1\u4e66\uff0c\u4e0d\u5b89\u5168\uff01\u5f3a\u70c8\u5efa\u8bae\u4e0d\u8bbe\u7f6e\uff01\n      # server-ca-file: /path/to/ca.pem # \u7528\u4e8e\u9a8c\u8bc1\u670d\u52a1\u5668\u8bc1\u4e66\u7684 CA \u8bc1\u4e66\n      # server-ca-file: # \u652f\u6301\u591a\u6587\u4ef6\n      #   - /path/to/ca1.pem\n      #   - /path/to/ca2.pem\n      # client-cert-file: /path/to/cert.pem # TLS \u5ba2\u6237\u7aef\u8bc1\u4e66\u6587\u4ef6\uff0c\u7528\u4e8e mTLS\n      # client-key-file: /path/to/key.pem # TLS \u5ba2\u6237\u7aef\u8bc1\u4e66\u6587\u4ef6\uff0c\u7528\u4e8e mTLS\n      # bootstrap: # \u5f53 address \u662f\u57df\u540d\u65f6\uff0c\u4f7f\u7528 bootstrap \u4e2d\u7684\u4e0a\u6e38\u670d\u52a1\u5668\u89e3\u6790\u57df\u540d\n        # upstream: bootstrap-upstream # \u4e0a\u6e38\u670d\u52a1\u5668\u6807\u7b7e\n        # strategy: '' # \u89e3\u6790\u7b56\u7565\uff0c\u53ef\u9009 prefer-ipv4 | prefer-ipv6 | only-ipv4 | only-ipv6 \uff0c\u9ed8\u8ba4\u4e3a prefer-ipv4\n      # bind-interface: eth0 # \u7ed1\u5b9a\u7f51\u5361\n      # bind-ipv4: 0.0.0.0 # \u7ed1\u5b9a\u672c\u5730 IPv4 \u5730\u5740\n      # bind-ipv6: :: # \u7ed1\u5b9a\u672c\u5730 IPv6 \u5730\u5740\n      # so-mark: 255 # \u8bbe\u7f6e SO_MARK (Linux)\n      # socks5: # \u4f7f\u7528 SOCKS5 \u4ee3\u7406\n      #   address: 127.0.0.1:1080 # SOCKS5 \u670d\u52a1\u5668\u5730\u5740\uff0c\u683c\u5f0f\uff1aIP:\u7aef\u53e3\n      #   username: '' # SOCKS5 \u7528\u6237\u540d\n      #   password: '' # SOCKS5 \u5bc6\u7801\n</code></pre>"},{"location":"upstream/parallel/","title":"Parallel","text":"<p>\u8bf7\u6c42\u5e76\u53d1\u53d1\u9001\u5230\u4e0a\u6e38\u670d\u52a1\u5668\uff0c\u53d6\u6700\u5148\u8fd4\u56de\u7684\u7ed3\u679c</p> <pre><code>upstreams:\n    - tag: upstream\n      type: parallel\n      upstreams:\n        - upstream-a\n        - upstream-b\n        - upstream-c\n</code></pre>"},{"location":"upstream/querytest/","title":"QueryTest","text":"<p>\u6d4b\u8bd5\u6240\u6709\u4e0a\u6e38\u670d\u52a1\u5668\uff0c\u5e76\u9009\u62e9\u5ef6\u8fdf\u6700\u4f4e\u7684\u4e0a\u6e38\u670d\u52a1\u5668</p> <pre><code>upstreams:\n    - tag: upstream\n      type: querytest\n      upstreams:\n        - upstream-a\n        - upstream-b\n        - upstream-c\n      test-domain: www.example.com # \u6d4b\u8bd5\u57df\u540d\n      test-interval: 600s # \u6d4b\u8bd5\u95f4\u9694\u65f6\u95f4\n      tolerance: 3ms # \u6bd4\u5f53\u524d\u6700\u4f73\u4e0a\u6e38\u670d\u52a1\u5668\u5ef6\u8fdf\u4f4e\u8d85\u8fc7 tolerance \u624d\u4f1a\u9009\u62e9\n</code></pre>"},{"location":"upstream/quic/","title":"QUIC","text":"<pre><code>upstreams:\n    - tag: upstream\n      type: quic\n      address: 223.5.5.5 # \u670d\u52a1\u5668\u5730\u5740\uff0c\u652f\u6301\u57df\u540d|\u57df\u540d:\u7aef\u53e3|IP|IP:\u7aef\u53e3\uff0c\u82e5\u670d\u52a1\u5668\u5730\u5740\u662f\u57df\u540d\uff0c\u5fc5\u987b\u8bbe\u7f6e bootstrap \u6216\uff08\u548c\uff09socks5\n      # connect-timeout: 30s # \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\n      # idle-timeout: 60s # \u8fde\u63a5\u7a7a\u95f2\u8d85\u65f6\u65f6\u95f4\n      # servername: '' # TLS SNI\uff0c\u82e5\u4e3a\u7a7a\uff0c\u5219\u8bbe\u7f6e\u4e3a address\n      # insecure: false # \u4e0d\u9a8c\u8bc1\u670d\u52a1\u5668\u8bc1\u4e66\uff0c\u4e0d\u5b89\u5168\uff01\u5f3a\u70c8\u5efa\u8bae\u4e0d\u8bbe\u7f6e\uff01\n      # server-ca-file: /path/to/ca.pem # \u7528\u4e8e\u9a8c\u8bc1\u670d\u52a1\u5668\u8bc1\u4e66\u7684 CA \u8bc1\u4e66\n      # server-ca-file: # \u652f\u6301\u591a\u6587\u4ef6\n      #   - /path/to/ca1.pem\n      #   - /path/to/ca2.pem\n      # client-cert-file: /path/to/cert.pem # TLS \u5ba2\u6237\u7aef\u8bc1\u4e66\u6587\u4ef6\uff0c\u7528\u4e8e mTLS\n      # client-key-file: /path/to/key.pem # TLS \u5ba2\u6237\u7aef\u8bc1\u4e66\u6587\u4ef6\uff0c\u7528\u4e8e mTLS\n      # bootstrap: # \u5f53 address \u662f\u57df\u540d\u65f6\uff0c\u4f7f\u7528 bootstrap \u4e2d\u7684\u4e0a\u6e38\u670d\u52a1\u5668\u89e3\u6790\u57df\u540d\n        # upstream: bootstrap-upstream # \u4e0a\u6e38\u670d\u52a1\u5668\u6807\u7b7e\n        # strategy: '' # \u89e3\u6790\u7b56\u7565\uff0c\u53ef\u9009 prefer-ipv4 | prefer-ipv6 | only-ipv4 | only-ipv6 \uff0c\u9ed8\u8ba4\u4e3a prefer-ipv4\n      # bind-interface: eth0 # \u7ed1\u5b9a\u7f51\u5361\n      # bind-ipv4: 0.0.0.0 # \u7ed1\u5b9a\u672c\u5730 IPv4 \u5730\u5740\n      # bind-ipv6: :: # \u7ed1\u5b9a\u672c\u5730 IPv6 \u5730\u5740\n      # so-mark: 255 # \u8bbe\u7f6e SO_MARK (Linux)\n      # socks5: # \u4f7f\u7528 SOCKS5 \u4ee3\u7406\n      #   address: 127.0.0.1:1080 # SOCKS5 \u670d\u52a1\u5668\u5730\u5740\uff0c\u683c\u5f0f\uff1aIP:\u7aef\u53e3\n      #   username: '' # SOCKS5 \u7528\u6237\u540d\n      #   password: '' # SOCKS5 \u5bc6\u7801\n</code></pre>"},{"location":"upstream/random/","title":"Random","text":"<p>\u968f\u673a\u5c06\u8bf7\u6c42\u53d1\u9001\u5230\u4e0a\u6e38\u670d\u52a1\u5668</p> <pre><code>upstreams:\n    - tag: upstream\n      type: random\n      upstreams:\n        - upstream-a\n        - upstream-b\n        - upstream-c\n</code></pre>"},{"location":"upstream/tcp/","title":"TCP","text":"<pre><code>upstreams:\n    - tag: upstream\n      type: tcp\n      address: 223.5.5.5 # \u670d\u52a1\u5668\u5730\u5740\uff0c\u652f\u6301\u57df\u540d|\u57df\u540d:\u7aef\u53e3|IP|IP:\u7aef\u53e3\uff0c\u82e5\u670d\u52a1\u5668\u5730\u5740\u662f\u57df\u540d\uff0c\u5fc5\u987b\u8bbe\u7f6e bootstrap \u6216\uff08\u548c\uff09socks5\n      # connect-timeout: 30s # \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\n      # idle-timeout: 60s # \u8fde\u63a5\u7a7a\u95f2\u8d85\u65f6\u65f6\u95f4\n      # enable-pipeline: false # \u662f\u5426\u542f\u7528 Pipeline (TCP)\n      # bootstrap: # \u5f53 address \u662f\u57df\u540d\u65f6\uff0c\u4f7f\u7528 bootstrap \u4e2d\u7684\u4e0a\u6e38\u670d\u52a1\u5668\u89e3\u6790\u57df\u540d\n        # upstream: bootstrap-upstream # \u4e0a\u6e38\u670d\u52a1\u5668\u6807\u7b7e\n        # strategy: '' # \u89e3\u6790\u7b56\u7565\uff0c\u53ef\u9009 prefer-ipv4 | prefer-ipv6 | only-ipv4 | only-ipv6 \uff0c\u9ed8\u8ba4\u4e3a prefer-ipv4\n      # bind-interface: eth0 # \u7ed1\u5b9a\u7f51\u5361\n      # bind-ipv4: 0.0.0.0 # \u7ed1\u5b9a\u672c\u5730 IPv4 \u5730\u5740\n      # bind-ipv6: :: # \u7ed1\u5b9a\u672c\u5730 IPv6 \u5730\u5740\n      # so-mark: 255 # \u8bbe\u7f6e SO_MARK (Linux)\n      # socks5: # \u4f7f\u7528 SOCKS5 \u4ee3\u7406\n      #   address: 127.0.0.1:1080 # SOCKS5 \u670d\u52a1\u5668\u5730\u5740\uff0c\u683c\u5f0f\uff1aIP:\u7aef\u53e3\n      #   username: '' # SOCKS5 \u7528\u6237\u540d\n      #   password: '' # SOCKS5 \u5bc6\u7801\n</code></pre>"},{"location":"upstream/tls/","title":"TLS","text":"<pre><code>upstreams:\n    - tag: upstream\n      type: tls\n      address: 223.5.5.5 # \u670d\u52a1\u5668\u5730\u5740\uff0c\u652f\u6301\u57df\u540d|\u57df\u540d:\u7aef\u53e3|IP|IP:\u7aef\u53e3\uff0c\u82e5\u670d\u52a1\u5668\u5730\u5740\u662f\u57df\u540d\uff0c\u5fc5\u987b\u8bbe\u7f6e bootstrap \u6216\uff08\u548c\uff09socks5\n      # connect-timeout: 30s # \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\n      # idle-timeout: 60s # \u8fde\u63a5\u7a7a\u95f2\u8d85\u65f6\u65f6\u95f4\n      # enable-pipeline: false # \u662f\u5426\u542f\u7528 Pipeline (TCP)\n      # servername: '' # TLS SNI\uff0c\u82e5\u4e3a\u7a7a\uff0c\u5219\u8bbe\u7f6e\u4e3a address\n      # insecure: false # \u4e0d\u9a8c\u8bc1\u670d\u52a1\u5668\u8bc1\u4e66\uff0c\u4e0d\u5b89\u5168\uff01\u5f3a\u70c8\u5efa\u8bae\u4e0d\u8bbe\u7f6e\uff01\n      # server-ca-file: /path/to/ca.pem # \u7528\u4e8e\u9a8c\u8bc1\u670d\u52a1\u5668\u8bc1\u4e66\u7684 CA \u8bc1\u4e66\n      # server-ca-file: # \u652f\u6301\u591a\u6587\u4ef6\n      #   - /path/to/ca1.pem\n      #   - /path/to/ca2.pem\n      # client-cert-file: /path/to/cert.pem # TLS \u5ba2\u6237\u7aef\u8bc1\u4e66\u6587\u4ef6\uff0c\u7528\u4e8e mTLS\n      # client-key-file: /path/to/key.pem # TLS \u5ba2\u6237\u7aef\u8bc1\u4e66\u6587\u4ef6\uff0c\u7528\u4e8e mTLS\n      # bootstrap: # \u5f53 address \u662f\u57df\u540d\u65f6\uff0c\u4f7f\u7528 bootstrap \u4e2d\u7684\u4e0a\u6e38\u670d\u52a1\u5668\u89e3\u6790\u57df\u540d\n        # upstream: bootstrap-upstream # \u4e0a\u6e38\u670d\u52a1\u5668\u6807\u7b7e\n        # strategy: '' # \u89e3\u6790\u7b56\u7565\uff0c\u53ef\u9009 prefer-ipv4 | prefer-ipv6 | only-ipv4 | only-ipv6 \uff0c\u9ed8\u8ba4\u4e3a prefer-ipv4\n      # bind-interface: eth0 # \u7ed1\u5b9a\u7f51\u5361\n      # bind-ipv4: 0.0.0.0 # \u7ed1\u5b9a\u672c\u5730 IPv4 \u5730\u5740\n      # bind-ipv6: :: # \u7ed1\u5b9a\u672c\u5730 IPv6 \u5730\u5740\n      # so-mark: 255 # \u8bbe\u7f6e SO_MARK (Linux)\n      # socks5: # \u4f7f\u7528 SOCKS5 \u4ee3\u7406\n      #   address: 127.0.0.1:1080 # SOCKS5 \u670d\u52a1\u5668\u5730\u5740\uff0c\u683c\u5f0f\uff1aIP:\u7aef\u53e3\n      #   username: '' # SOCKS5 \u7528\u6237\u540d\n      #   password: '' # SOCKS5 \u5bc6\u7801\n</code></pre>"},{"location":"upstream/udp/","title":"UDP","text":"<pre><code>upstreams:\n    - tag: upstream\n      type: udp\n      address: 223.5.5.5 # \u670d\u52a1\u5668\u5730\u5740\uff0c\u652f\u6301\u57df\u540d|\u57df\u540d:\u7aef\u53e3|IP|IP:\u7aef\u53e3\uff0c\u82e5\u670d\u52a1\u5668\u5730\u5740\u662f\u57df\u540d\uff0c\u5fc5\u987b\u8bbe\u7f6e bootstrap \u6216\uff08\u548c\uff09socks5\n      # connect-timeout: 30s # \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\n      # idle-timeout: 60s # \u8fde\u63a5\u7a7a\u95f2\u8d85\u65f6\u65f6\u95f4\n      # edns0: false # \u542f\u7528 EDNS0 \u652f\u6301\uff0c\u8be6\u60c5\u53c2\u8003 https://github.com/IrineSistiana/udpme\n      # enable-pipeline: false # \u662f\u5426\u542f\u7528 Pipeline (TCP)\n      # bootstrap: # \u5f53 address \u662f\u57df\u540d\u65f6\uff0c\u4f7f\u7528 bootstrap \u4e2d\u7684\u4e0a\u6e38\u670d\u52a1\u5668\u89e3\u6790\u57df\u540d\n        # upstream: bootstrap-upstream # \u4e0a\u6e38\u670d\u52a1\u5668\u6807\u7b7e\n        # strategy: '' # \u89e3\u6790\u7b56\u7565\uff0c\u53ef\u9009 prefer-ipv4 | prefer-ipv6 | only-ipv4 | only-ipv6 \uff0c\u9ed8\u8ba4\u4e3a prefer-ipv4\n      # bind-interface: eth0 # \u7ed1\u5b9a\u7f51\u5361\n      # bind-ipv4: 0.0.0.0 # \u7ed1\u5b9a\u672c\u5730 IPv4 \u5730\u5740\n      # bind-ipv6: :: # \u7ed1\u5b9a\u672c\u5730 IPv6 \u5730\u5740\n      # so-mark: 255 # \u8bbe\u7f6e SO_MARK (Linux)\n      # socks5: # \u4f7f\u7528 SOCKS5 \u4ee3\u7406\n      #   address: 127.0.0.1:1080 # SOCKS5 \u670d\u52a1\u5668\u5730\u5740\uff0c\u683c\u5f0f\uff1aIP:\u7aef\u53e3\n      #   username: '' # SOCKS5 \u7528\u6237\u540d\n      #   password: '' # SOCKS5 \u5bc6\u7801\n</code></pre>"},{"location":"workflow/","title":"Workflow \u5904\u7406\u6d41\u7a0b","text":"<p><code>Workflow</code> \u662f <code>cdns</code> \u7684\u6838\u5fc3\uff0c\u7528\u6237\u53ef\u4ee5\u81ea\u5b9a\u4e49 <code>Workflow</code> \u7684\u5904\u7406\u6d41\u7a0b\uff0c<code>cdns</code> \u4f1a\u6309\u7167\u7528\u6237\u5b9a\u4e49\u7684\u6d41\u7a0b\u5904\u7406\u8bf7\u6c42</p> <p>\u683c\u5f0f\u793a\u4f8b\uff1a <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            ...\n          exec:\n            ...\n\n        - match-or:\n            ...\n          exec:\n            ...\n\n        - exec:\n            ...\n</code></pre></p> <p><code>Workflow</code> \u57fa\u4e8e\u903b\u8f91\u5904\u7406\u673a\u5236\uff0c\u7c7b\u4f3c\u4e8e <code>if-else</code>\uff0c<code>Workflow</code> \u5b9a\u4e49\u4e86\u4e09\u79cd\u903b\u8f91\u5904\u7406\u673a\u5236\uff1a</p> <pre><code>match-and:                 match-or:                 exec:\n    array[\u5339\u914d\u5668]             array[\u5339\u914d\u5668]              array[\u6267\u884c\u5668]\nexec:                     exec:               \n    array[\u6267\u884c\u5668]             array[\u6267\u884c\u5668]    \nelse-exec:                else-exec:          \n    array[\u6267\u884c\u5668]             array[\u6267\u884c\u5668]   \n</code></pre> <ul> <li> <p><code>match-and</code>\uff1a\u5f53\u6240\u6709 <code>match-and</code> \u4e2d\u7684\u5339\u914d\u5668\u90fd\u6ee1\u8db3\u65f6\uff0c\u6267\u884c <code>exec</code> \u4e2d\u7684\u6267\u884c\u5668\uff0c\u5426\u5219\u6267\u884c <code>else-exec</code> \u4e2d\u7684\u6267\u884c\u5668</p> </li> <li> <p><code>match-or</code>\uff1a\u5f53\u4efb\u610f\u4e00\u4e2a <code>match-or</code> \u4e2d\u7684\u5339\u914d\u5668\u6ee1\u8db3\u65f6\uff0c\u6267\u884c <code>exec</code> \u4e2d\u7684\u6267\u884c\u5668\uff0c\u5426\u5219\u6267\u884c <code>else-exec</code> \u4e2d\u7684\u6267\u884c\u5668</p> </li> <li> <p><code>exec</code>\uff1a\u6267\u884c <code>exec</code> \u4e2d\u7684\u6267\u884c\u5668</p> </li> <li> <p><code>match-and</code> / <code>match-or</code> / <code>exec</code> / <code>else-exec</code> \u6240\u6709\u5339\u914d\u5668\u6216\u8005\u6267\u884c\u5668\u662f\u6570\u7ec4\u7c7b\u578b\uff0c\u5e76\u4e14\u5339\u914d/\u6267\u884c\u987a\u5e8f\u662f\u6570\u7ec4\u4e2d\u7684\u987a\u5e8f</p> </li> </ul>"},{"location":"workflow/executor/","title":"Workflow - Executor \u6267\u884c\u5668","text":"<p>\u4e0b\u9762\u662f\u4e00\u4e9b <code>Workflow</code> \u9884\u5b9a\u4e49\u7684\u6267\u884c\u5668</p> <ul> <li><code>Mark</code></li> <li><code>Metadata</code></li> <li><code>Plugin</code></li> <li><code>Upstream</code></li> <li><code>Jump-To</code></li> <li><code>Go-To</code></li> <li><code>Workflow-Rules</code></li> <li><code>Fallback</code></li> <li><code>Parallel</code></li> <li><code>Set-TTL</code></li> <li><code>Set-Resp-IP</code></li> <li><code>Clean</code></li> <li><code>Return</code></li> </ul>"},{"location":"workflow/executor/#mark","title":"<code>Mark</code>","text":"<p>\u8bbe\u7f6e <code>Mark</code></p> <p>\u503c\u7c7b\u578b\uff1a\u975e\u8d1f\u6574\u6570</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            ...\n          exec:\n            - mark: 1 # \u8bbe\u7f6e Mark \u4e3a 1\n            - mark: 0 # \u5220\u9664 Mark\n</code></pre>"},{"location":"workflow/executor/#metadata","title":"<code>Metadata</code>","text":"<p>\u8bbe\u7f6e <code>Metadata</code>\uff0c\u6240\u6709 <code>Metadata</code> \u90fd\u4f1a\u88ab\u8bbe\u7f6e</p> <p>\u503c\u7c7b\u578b\uff1a\u952e\u503c\u5bf9(\u5b57\u7b26\u4e32 =&gt; \u5b57\u7b26\u4e32)</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            ...\n          exec:\n            - metadata:\n                foo: bar # \u8bbe\u7f6e Metadata foo \u4e3a bar\n                foo2: '' # \u5220\u9664 Metadata foo2\n</code></pre>"},{"location":"workflow/executor/#plugin","title":"<code>Plugin</code>","text":"<p>\u901a\u8fc7\u6267\u884c\u5668\u63d2\u4ef6\u6267\u884c</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            ...\n          exec:\n            - plugin:\n                tag: plugin-tag # \u63d2\u4ef6\u6807\u7b7e\n                args: # \u63d2\u4ef6\u53c2\u6570\uff0c\u89c6\u63d2\u4ef6\u800c\u5b9a\n                  foo: bar\n</code></pre>"},{"location":"workflow/executor/#upstream","title":"<code>Upstream</code>","text":"<p>\u5411 <code>Upstream</code> \u53d1\u9001\u8bf7\u6c42\u5e76\u83b7\u5f97\u54cd\u5e94</p> <p>\u503c\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            ...\n          exec:\n            - upstream: upstream-default\n            # - upstream:\n            #     tag: upstream-default\n            #     strategy: prefer-ipv4 # \u82e5\u8bf7\u6c42\u4e3a AAAA \uff0c\u5219\u540c\u65f6\u8bf7\u6c42 A \uff0c\u82e5 A \u8fd4\u56de\u6709\u6548\u54cd\u5e94\uff0c\u5219\u5ffd\u7565 AAAA \u7684\u54cd\u5e94\uff0c\u751f\u6210\u7a7a\u54cd\u5e94 (Rcode: Success) (SOA)\n            #     # strategy: prefer-ipv6 # \u82e5\u8bf7\u6c42\u4e3a A \uff0c\u5219\u540c\u65f6\u8bf7\u6c42 AAAA \uff0c\u82e5 AAAA \u8fd4\u56de\u6709\u6548\u54cd\u5e94\uff0c\u5219\u5ffd\u7565 A \u7684\u54cd\u5e94\uff0c\u751f\u6210\u7a7a\u54cd\u5e94 (Rcode: Success) (SOA)\n</code></pre>"},{"location":"workflow/executor/#jump-to","title":"<code>Jump-To</code>","text":"<p>\u8df3\u8f6c\u5230\u6307\u5b9a\u7684 <code>Workflow</code> \u5904\u7406\uff0c\u5904\u7406\u7ed3\u675f\u540e\u8fd4\u56de\u5230\u5f53\u524d <code>Workflow</code> \u7ee7\u7eed\u5904\u7406</p> <p>\u503c\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32 | \u6570\u7ec4(\u5b57\u7b26\u4e32)</p> <pre><code>workflows:\n    - tag: w1\n      rules:\n        ...\n\n    - tag: w2\n      rules:\n        ...\n\n    - tag: default\n      rules:\n        - match-and:\n            ...\n          exec:\n            - jump-to: w1\n            - jump-to: # \u987a\u5e8f\u6267\u884c w1 \u548c w2\n                - w1\n                - w2\n</code></pre>"},{"location":"workflow/executor/#go-to","title":"<code>Go-To</code>","text":"<p>\u8df3\u8f6c\u5230\u6307\u5b9a\u7684 <code>Workflow</code> \u5904\u7406\uff0c\u5904\u7406\u7ed3\u675f\u540e\u4e0d\u4f1a\u8fd4\u56de\u5230\u5f53\u524d <code>Workflow</code> \u7ee7\u7eed\u5904\u7406</p> <p>\u503c\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32</p> <pre><code>workflows:\n    - tag: w1\n      rules:\n        ...\n\n    - tag: default\n      rules:\n        - match-and:\n            ...\n          exec:\n            - go-to: w1\n</code></pre>"},{"location":"workflow/executor/#workflow-rules","title":"<code>Workflow-Rules</code>","text":"<p>\u5185\u7f6e\u7684 <code>Workflow</code> \u5904\u7406\u903b\u8f91\uff0c\u7528\u4e8e\u5728 <code>Workflow</code> \u4e2d\u5d4c\u5957 <code>Workflow</code> \u5904\u7406</p> <p>\u503c\u7c7b\u578b\uff1a\u6570\u7ec4(match-and | match-or | exec)</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            ...\n          exec:\n            - workflow-rules:\n                - match-or:\n                    ...\n                  exec:\n                    ...\n\n                - match-and:\n                    ...\n                  exec:\n                    ...\n</code></pre>"},{"location":"workflow/executor/#fallback","title":"<code>Fallback</code>","text":"<p>\u8bbe\u7f6e\u4e3b-\u4ece\u903b\u8f91\uff0c\u5f53\u4e3b\u903b\u8f91\u5904\u7406\u5931\u8d25\u65f6\uff0c\u4f1a\u5c1d\u8bd5\u4ece\u903b\u8f91\u5904\u7406</p> <ul> <li>\u4e3b\u4ece\u903b\u8f91\u4f1a\u514b\u9686\u539f\u4e0a\u4e0b\u6587\uff0c\u5e76\u5728\u5904\u7406\u6210\u529f\u540e\u6539\u5199\u539f\u4e0a\u4e0b\u6587\uff0c\u4e3b\u4ece\u903b\u8f91\u4e0a\u4e0b\u6587\u4e0d\u76f8\u4e92\u51b2\u7a81</li> </ul> <pre><code>workflows:\n    - tag: w1\n      rules:\n        ...\n\n    - tag: w2\n      rules:\n        ...\n\n    - tag: default\n      rules:\n        - match-and:\n            ...\n          exec:\n            - fallback:\n                main: # \u4e0e main-workflow \u4e24\u8005\u53ea\u80fd\u8bbe\u7f6e\u4e00\u4e2a\n                    - match-and:\n                        ...\n                      exec:\n                        ...\n                    ...\n                main-workflow: w1 # \u4e0e main \u4e24\u8005\u53ea\u80fd\u8bbe\u7f6e\u4e00\u4e2a\n                fallback: # \u4e0e fallback-workflow \u4e24\u8005\u53ea\u80fd\u8bbe\u7f6e\u4e00\u4e2a\n                    - match-and:\n                        ...\n                      exec:\n                        ...\n                    ...\n                fallback-workflow: w2 # \u4e0e fallback \u4e24\u8005\u53ea\u80fd\u8bbe\u7f6e\u4e00\u4e2a\n                wait-time: 0 # \u4ece\u903b\u8f91\u542f\u52a8\u7b49\u5f85\u65f6\u95f4\n</code></pre>"},{"location":"workflow/executor/#parallel","title":"<code>Parallel</code>","text":"<p>\u5e76\u884c\u6267\u884c\u591a\u4e2a\u5904\u7406\u6d41\u7a0b\uff0c\u53d6\u6700\u5feb\u7684\u4e00\u4e2a\u4f5c\u4e3a\u7ed3\u679c</p> <ul> <li>\u65b0\u5904\u7406\u6d41\u7a0b\u4f1a\u514b\u9686\u539f\u4e0a\u4e0b\u6587\uff0c\u5e76\u5728\u5904\u7406\u6210\u529f\u540e\u6539\u5199\u539f\u4e0a\u4e0b\u6587\uff0c\u6240\u6709\u5904\u7406\u6d41\u7a0b\u4e0a\u4e0b\u6587\u4e0d\u76f8\u4e92\u51b2\u7a81</li> </ul> <pre><code>workflows:\n    - tag: w1\n      rules:\n        ...\n\n    - tag: w2\n      rules:\n        ...\n\n    - tag: default\n      rules:\n        - match-and:\n            ...\n          exec:\n            - parallel:\n                workflows:\n                  - w1\n                  - w2\n</code></pre>"},{"location":"workflow/executor/#set-ttl","title":"<code>Set-TTL</code>","text":"<p>\u8bbe\u7f6e\u54cd\u5e94\u7684 <code>TTL</code></p> <p>\u503c\u7c7b\u578b\uff1a\u975e\u8d1f\u6574\u6570</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            ...\n          exec:\n            - set-ttl: 3600 # \u8bbe\u7f6e TTL \u4e3a 3600 \u79d2\n</code></pre>"},{"location":"workflow/executor/#set-resp-ip","title":"<code>Set-Resp-IP</code>","text":"<p>\u8bbe\u7f6e\u54cd\u5e94\u7684 <code>IP</code></p> <p>\u503c\u7c7b\u578b\uff1a(<code>IP</code> / <code>CIDR</code>) | \u6570\u7ec4(<code>IP</code> / <code>CIDR</code>)</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            ...\n          exec:\n            - set-resp-ip: 192.168.1.1 # \u53ea\u5bf9 A \u8bf7\u6c42\u6709\u6548\n            - set-resp-ip: # \u8fd9\u6837\u4e5f\u53ef\u4ee5\uff0c\u4f1a\u9644\u52a0\u6240\u6709\u6709\u6548\u7684 IP\n                - 192.168.1.1 # \u53ea\u5bf9 A \u8bf7\u6c42\u6709\u6548\n                - 192.168.1.0/24 # \u53ea\u5bf9 A \u8bf7\u6c42\u6709\u6548\uff0c\u4e14\u4f1a\u5728 CIDR \u4e2d\u968f\u673a\u6311\u9009\u4e00\u4e2a IP\n            - set-resp-ip: fd00::1 # \u53ea\u5bf9 AAAA \u8bf7\u6c42\u6709\u6548\n            - set-resp-ip: # \u8fd9\u6837\u4e5f\u53ef\u4ee5\uff0c\u4f1a\u9644\u52a0\u6240\u6709\u6709\u6548\u7684 IP\n                - fd00::1 # \u53ea\u5bf9 AAAA \u8bf7\u6c42\u6709\u6548\n                - fd00::1/60 # \u53ea\u5bf9 AAAA \u8bf7\u6c42\u6709\u6548\uff0c\u4e14\u4f1a\u5728 CIDR \u4e2d\u968f\u673a\u6311\u9009\u4e00\u4e2a IP\n</code></pre>"},{"location":"workflow/executor/#clean","title":"<code>Clean</code>","text":"<p>\u6e05\u7406\u54cd\u5e94\u4fe1\u606f</p> <p>\u503c\u7c7b\u578b\uff1a\u5e03\u5c14\u503c | \u65e0</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            ...\n          exec:\n            - clean: true\n            - clean: false # \u65e0\u6548\n            - clean # \u8fd9\u6837\u4e5f\u53ef\u4ee5\uff0c\u7b49\u6548\u4e8e - clean: true\n</code></pre>"},{"location":"workflow/executor/#return","title":"<code>Return</code>","text":"<p>\u9000\u51fa\u5904\u7406\u6d41\u7a0b\uff0c\u8fd4\u56de\u54cd\u5e94</p> <p>\u503c\u7c7b\u578b\uff1a\u5e03\u5c14\u503c | \u5b57\u7b26\u4e32 | \u65e0</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            ...\n          exec:\n            - return: true # \u9000\u51fa\u6240\u6709\u5904\u7406\u6d41\u7a0b\uff0c\u76f4\u63a5\u8fd4\u56de\n            - return: false # \u65e0\u6548\n            - return # \u8fd9\u6837\u4e5f\u53ef\u4ee5\uff0c\u7b49\u6548\u4e8e - return: true\n            - return: all # \u9000\u51fa\u6240\u6709\u5904\u7406\u6d41\u7a0b\uff0c\u76f4\u63a5\u8fd4\u56de\uff0c\u7b49\u6548\u4e8e - return: true\n            - return: once # \u9000\u51fa\u5f53\u524d\u5904\u7406\u6d41\u7a0b\uff0c\u8fd4\u56de\u5230\u4e0a\u4e00\u4e2a\u5904\u7406\u6d41\u7a0b\n            - return: success # \u9000\u51fa\u6240\u6709\u5904\u7406\u6d41\u7a0b\uff0c\u5e76\u751f\u6210\u54cd\u5e94(Rcode: Success)\n            - return: failure # \u9000\u51fa\u6240\u6709\u5904\u7406\u6d41\u7a0b\uff0c\u5e76\u751f\u6210\u54cd\u5e94(Rcode: Failure)\n            - return: nxdomain # \u9000\u51fa\u6240\u6709\u5904\u7406\u6d41\u7a0b\uff0c\u5e76\u751f\u6210\u54cd\u5e94(Rcode: Nxdomain)\n            - return: refused # \u9000\u51fa\u6240\u6709\u5904\u7406\u6d41\u7a0b\uff0c\u5e76\u751f\u6210\u54cd\u5e94(Rcode: Refused)\n</code></pre>"},{"location":"workflow/matcher/","title":"Workflow - Matcher \u5339\u914d\u5668","text":"<p>\u4e0b\u9762\u662f\u4e00\u4e9b <code>Workflow</code> \u9884\u5b9a\u4e49\u7684\u5339\u914d\u5668</p> <ul> <li><code>Listener</code></li> <li><code>Client-IP</code></li> <li><code>QType</code></li> <li><code>QName</code></li> <li><code>Has-Resp-Msg</code></li> <li><code>Resp-IP</code></li> <li><code>Mark</code></li> <li><code>Env</code></li> <li><code>Metadata</code></li> <li><code>Plugin</code></li> <li><code>Match-And</code></li> <li><code>Match-Or</code></li> <li><code>Invert</code> *</li> </ul>"},{"location":"workflow/matcher/#listener","title":"<code>Listener</code>","text":"<p>\u5339\u914d\u8bf7\u6c42\u7684\u76d1\u542c\u5668</p> <p>\u503c\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32 | \u6570\u7ec4(\u5b57\u7b26\u4e32)</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            - listener: listener-tcp\n            - listener: # \u8fd9\u6837\u4e5f\u53ef\u4ee5\uff0c\u53ea\u9700\u4e00\u4e2a\u5339\u914d\u5373\u53ef\n                - listener-tcp\n                - listener-udp\n          exec:\n            ...\n</code></pre>"},{"location":"workflow/matcher/#client-ip","title":"<code>Client-IP</code>","text":"<p>\u5339\u914d\u8bf7\u6c42\u7684\u5ba2\u6237\u7aef IP</p> <p>\u503c\u7c7b\u578b\uff1a(<code>IP</code> / <code>CIDR</code>) | \u6570\u7ec4(<code>IP</code> / <code>CIDR</code>)</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            - client-ip: 192.168.0.2\n            - client-ip: # \u8fd9\u6837\u4e5f\u53ef\u4ee5\uff0c\u53ea\u9700\u4e00\u4e2a\u5339\u914d\u5373\u53ef\n                - 192.168.0.4\n                - 192.168.0.0/24 # \u8fd9\u6837\u4e5f\u53ef\u4ee5\n          exec:\n            ...\n</code></pre>"},{"location":"workflow/matcher/#qtype","title":"<code>QType</code>","text":"<p>\u5339\u914d\u8bf7\u6c42\u7684\u67e5\u8be2\u7c7b\u578b</p> <p>\u503c\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32 | \u6570\u7ec4(\u5b57\u7b26\u4e32) | \u6b63\u6574\u6570 | \u6570\u7ec4(\u6b63\u6574\u6570)</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            - qtype: 28 # AAAA\n            - qtype: # \u8fd9\u6837\u4e5f\u53ef\u4ee5\uff0c\u53ea\u9700\u4e00\u4e2a\u5339\u914d\u5373\u53ef\n                - 28 # AAAA\n                - HTTPS # \u8fd9\u6837\u4e5f\u53ef\u4ee5, 65\n          exec:\n            ...\n</code></pre>"},{"location":"workflow/matcher/#qname","title":"<code>QName</code>","text":"<p>\u5339\u914d\u8bf7\u6c42\u7684\u67e5\u8be2\u540d</p> <p>\u503c\u7c7b\u578b\uff1a\u5b57\u7b26\u4e32 | \u6570\u7ec4(\u5b57\u7b26\u4e32)</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            - qname: www.google.com\n            - qname: # \u8fd9\u6837\u4e5f\u53ef\u4ee5\uff0c\u53ea\u9700\u4e00\u4e2a\u5339\u914d\u5373\u53ef\n                - www.google.com\n                - www.youtube.com\n          exec:\n            ...\n</code></pre>"},{"location":"workflow/matcher/#has-resp-msg","title":"<code>Has-Resp-Msg</code>","text":"<p>\u5339\u914d\u8bf7\u6c42\u662f\u5426\u6709\u54cd\u5e94\u6d88\u606f</p> <p>\u503c\u7c7b\u578b\uff1a\u5e03\u5c14\u503c</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            - has-resp-msg: true # \u662f\u5426\u6709\u54cd\u5e94\u6d88\u606f\n            - has-resp-msg: false # \u662f\u5426\u6ca1\u6709\u54cd\u5e94\u6d88\u606f\n          exec:\n            ...\n</code></pre>"},{"location":"workflow/matcher/#resp-ip","title":"<code>Resp-IP</code>","text":"<p>\u5339\u914d\u54cd\u5e94 IP\uff0c\u6240\u6709 <code>IP</code> \u5730\u5740\u53ea\u9700\u8981\u5339\u914d\u4e00\u4e2a\u5373\u53ef</p> <p>\u503c\u7c7b\u578b\uff1a(<code>IP</code> / <code>CIDR</code>) | \u6570\u7ec4(<code>IP</code> / <code>CIDR</code>)</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            - resp-ip: 192.168.0.1\n            - resp-ip: # \u8fd9\u6837\u4e5f\u53ef\u4ee5\uff0c\u53ea\u9700\u4e00\u4e2a\u5339\u914d\u5373\u53ef\n                - 192.168.0.2\n                - 192.168.0.0/24 # \u8fd9\u6837\u4e5f\u53ef\u4ee5\n          exec:\n            ...\n</code></pre>"},{"location":"workflow/matcher/#mark","title":"<code>Mark</code>","text":"<p>\u5339\u914d\u6807\u8bb0 <code>Mark</code>\uff0c\u6240\u6709 <code>Mark</code> \u53ea\u9700\u8981\u5339\u914d\u4e00\u4e2a\u5373\u53ef</p> <ul> <li><code>Mark</code> \u53ef\u4ee5\u901a\u8fc7 <code>Mark</code> \u6267\u884c\u5668\u8bbe\u7f6e</li> </ul> <p>\u503c\u7c7b\u578b\uff1a\u6b63\u6574\u6570 | \u6570\u7ec4(\u6b63\u6574\u6570)</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            - mark: 1\n            - mark: # \u8fd9\u6837\u4e5f\u53ef\u4ee5\uff0c\u53ea\u9700\u4e00\u4e2a\u5339\u914d\u5373\u53ef\n                - 2\n                - 3\n          exec:\n            ...\n</code></pre>"},{"location":"workflow/matcher/#env","title":"<code>Env</code>","text":"<p>\u5339\u914d\u73af\u5883\u53d8\u91cf <code>Env</code>\uff0c\u6240\u6709 <code>Env</code> \u53ea\u9700\u8981\u5339\u914d\u4e00\u4e2a\u5373\u53ef</p> <p>\u503c\u7c7b\u578b\uff1a\u952e\u503c\u5bf9(\u5b57\u7b26\u4e32 =&gt; \u5b57\u7b26\u4e32)</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            - env:\n                foo: bar\n                foo2: bar2\n          exec:\n            ...\n</code></pre>"},{"location":"workflow/matcher/#metadata","title":"<code>Metadata</code>","text":"<p>\u5339\u914d <code>Metadata</code>\uff0c\u6240\u6709 <code>Metadata</code> \u53ea\u9700\u8981\u5339\u914d\u4e00\u4e2a\u5373\u53ef</p> <ul> <li><code>Metadata</code> \u53ef\u4ee5\u901a\u8fc7 <code>Metadata</code> \u6267\u884c\u5668\u8bbe\u7f6e</li> </ul> <p>\u503c\u7c7b\u578b\uff1a\u952e\u503c\u5bf9(\u5b57\u7b26\u4e32 =&gt; \u5b57\u7b26\u4e32)</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            - metadata:\n                foo: bar\n                foo2: bar2\n          exec:\n            ...\n</code></pre>"},{"location":"workflow/matcher/#plugin","title":"<code>Plugin</code>","text":"<p>\u901a\u8fc7\u5339\u914d\u5668\u63d2\u4ef6\u5339\u914d\u8bf7\u6c42</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            - plugin:\n                tag: plugin-tag # \u63d2\u4ef6\u6807\u7b7e\n                args: # \u63d2\u4ef6\u53c2\u6570\uff0c\u89c6\u63d2\u4ef6\u800c\u5b9a\n                  foo: bar\n          exec:\n            ...\n</code></pre>"},{"location":"workflow/matcher/#match-and","title":"<code>Match-And</code>","text":"<p>\u8981\u6c42\u5339\u914d <code>match-and</code> \u4e2d\u7684\u6240\u6709\u5339\u914d\u5668</p> <p>\u503c\u7c7b\u578b\uff1a\u6570\u7ec4(\u5339\u914d\u5668)</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            - match-and:\n                - ...\n                - ...\n          exec:\n            ...\n</code></pre>"},{"location":"workflow/matcher/#match-or","title":"<code>Match-Or</code>","text":"<p>\u8981\u6c42\u5339\u914d <code>match-or</code> \u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u5339\u914d\u5668</p> <p>\u503c\u7c7b\u578b\uff1a\u6570\u7ec4(\u5339\u914d\u5668)</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            - match-or:\n                - ...\n                - ...\n          exec:\n            ...\n</code></pre>"},{"location":"workflow/matcher/#invert","title":"<code>Invert</code>","text":"<p>\u53cd\u8f6c\u5339\u914d\u7ed3\u679c\uff0c\u53ef\u4ee5\u9644\u52a0\u5728\u4efb\u610f\u5339\u914d\u5668\u4e0a</p> <pre><code>workflows:\n    - tag: default\n      rules:\n        - match-and:\n            - client-ip: 192.168.1.1\n              invert: true # \u53cd\u8f6c\u5339\u914d\u7ed3\u679c\n            - resp-ip:\n                - 192.168.1.3\n                - 192.168.1.0/24\n              invert: true # \u53cd\u8f6c\u5339\u914d\u7ed3\u679c\n          exec:\n            ...\n</code></pre>"}]}